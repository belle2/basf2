Changes in the analysis package since release-05-01
---------------------------------------------------

Vertex Fitting
++++++++++++++

 * KFit has been extended to be able to handle vertex fits (with and without mass constraint) that involve an eta particle
   reconstructed in ``eta -> gamma gamma``.

Variables
+++++++++

 * Variables :b2:var:`SoftwareTriggerResult`, :b2:var:`SoftwareTriggerResultNonPrescaled` and :b2:var:`SoftwareTriggerPrescaling`
   now silently return NAN if the trigger is not found.

   .. warning:: this no longer dumps all possible trigger names instead please see ``b2hlt_triggers`` for a list of all possible names.

   .. seealso:: ``b2hlt_triggers print --database online --format list``

 * Variables :b2:var:`recQ2Bh`, :b2:var:`recMissM2`, :b2:var:`recQ2BhSimple` have been moved to a new variable group ``Specific kinematic variables``,
   and :b2:var:`recQ2Bh` is now using a `diamond frame method <https://www.osti.gov/biblio/1442697>`_
 * Added the new variable :b2:var:`photonHasOverlap`, which determines whether a particle's cluster is sharing its connected
   region with another cluster. A cut string can be provided to ignore cluster that do not satisfy the specified criteria.
 * Variables `clusterThetaID` and `clusterPhiID` have both been added as a new variable
 * Event-based variables from ``cluster`` collection have been moved into a new ``event_level_cluster`` collection,
   collections of ROE and recoil variables have been expanded
 * Added the variable :b2:var:`binaryPID`, which takes two PID codes as arguments and calculates the binary PID between them. A few
   binary PID variables have been added to the PID variable collection.

   .. hint:: The hadron PID group recommends to try out the binary PID in analyses and compare the performance with the global PID.

 * Added a new variable :b2:var:`nROE_Composites` to count V0 particles in ROE.
 * Added meta variables corresponding to existing variables that access the MC matched particles of given daughters
   :b2:var:`mcDaughterDiffOf` , :b2:var:`mcDaughterDiffOfPhi`, :b2:var:`mcDaughterDiffOfPhiCMS`, :b2:var:`mcDaughterAngle`.
 * Added the new variable :b2:var:`mcCosThetaBetweenParticleAndNominalB`. This is an MC version of
   :b2:var:`cosThetaBetweenParticleAndNominalB` in which all descendant neutrino momenta are subtracted from the B momentum
   during the calculation.
 * Added the inverse trigonometric functions: :b2:var:`acos`, :b2:var:`asin`.
 * Added new variables :b2:var:`exp` and :b2:var:`log`.
 * Added special hadron ID variables :b2:var:`pionID_SVD`, :b2:var:`kaonID_SVD`, :b2:var:`protonID_SVD`, :b2:var:`binaryPID_SVD` which include SVD PDFs for pions, kaons and protons only. For hadron ID, users should **no longer** rely on the standard variables :b2:var:`pionID`, :b2:var:`kaonID`, :b2:var:`protonID`, :b2:var:`binaryPID` for the time being. For lepton identification instead, the :b2:var:`electronID`, :b2:var:`muonID`, :b2:var:`binaryPID` variables, which do not contain SVD PDF info yet, are still recommended.

Modules
+++++++

 * The :b2:mod:`InclusiveDstarReconstruction` creates antiparticle lists correctly now. The module's input changed to a
   :ref:`DecayString` of the form ``D* -> pi`` and MC Matching is applicable (one can use :b2:var:`isSignal`).
 * In `BtubeCreator` module, functionality to apply a cut on the confidence level of the fit of fully reconstructed B to the
   beamspot is added.
 * The ``EventKinematics`` module can now compute event kinematics using generated particles as an input.
 * Arguments of `writePi0EtaVeto` have been updated. ``downloadFlag`` and ``workingDirectory`` have been removed since the
   download processes can be skipped. New arguments have been added for several reasons. ``suffix`` allows to calculate this
   veto for multiple photons. ``hardParticle`` allows to call this function for a given particle other than a photon.
   Four new arguments have been added to override the payload names and soft photon selections, ``pi0PayloadNameOverride``,
   ``etaPayloadNameOverride``, ``pi0SoftPhotonCutOverride``, and ``etaSoftPhotonCutOverride``.
 * A new helper method `updateROEUsingV0Lists` has been added to facilitate application of V0Finder results in Rest Of Event.
 * Added a possibility to add a ROE mask for KLM-based particles and an experimental option of including KLM-based particles into ROE 4-vector computation.

   .. warning:: The option ``useKLMEnergy`` of `RestOfEventBuilder` module is only meant for performance studies and NOT for a physics analysis.

 * The :b2:mod:`PrintMCParticles` module and thus also the `printMCParticles` function
   has a completely new layout that should be much easier to parse, especially for complicated events. By default it shows
   much less information but in an easier to parse tree representation. See the documentation of `printMCParticles` for details.

 * The :b2:mod:`ParticleLoader` now creates photon candidates from KLMCluster if the parameter ``loadPhotonsFromKLM`` is set to
   true. It is off by default.

   .. warning:: Photons from KLMCluster should only be used in specific use-cases and after a thorough study of their effect.

Full Event Interpretation
+++++++++++++++++++++++++

 * Added option to reconstruct strange B mesons (at Y(5S)) in 51 decay channels. Can be switched on with the ``strangeB`` flag in
   `fei.get_default_channels()`.
