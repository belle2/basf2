#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Thomas Keck 2014

from basf2 import *
from fei import *

chargedTrackVars = [
    'eid',
    'eid_dEdx',
    'eid_TOP',
    'eid_ARICH',
    'eid_ECL',
    'Kid',
    'Kid_dEdx',
    'Kid_TOP',
    'Kid_ARICH',
    'prid',
    'prid_dEdx',
    'prid_TOP',
    'prid_ARICH',
    'muid',
    'muid_dEdx',
    'muid_TOP',
    'muid_ARICH',
    'p',
    'pt',
    'chiProb']

mvaConfig_chargedFSP = MVAConfiguration(
    variables=chargedTrackVars,
    target='isSignal',
)

mvaConfig_D = MVAConfiguration(
    variables=['daughterProductOf(extraInfo(SignalProbability))', 'daughterAngle(0, 1)', 'p', 'pt', 'M', 'dr', 'dz', 'distance', 'significanceOfDistance', 'chiProb'],
    target='isSignal',
)

preCutConfiguration_nonFSP = PreCutConfiguration(
    variable='M',
    binning=(500, 0.0, 6.0),
    efficiency=0.8,
    purity=0.0001,
)

particles = []
particles.append(Particle('pi+', mvaConfig_chargedFSP))
particles.append(Particle('pi+:special', mvaConfig_chargedFSP))
particles.append(Particle('K+', mvaConfig_chargedFSP))


p = Particle('D0', mvaConfig_D, preCutConfiguration_nonFSP)
p.addChannel(['K-', 'pi+'])
particles.append(p)

p = Particle('D0:special', mvaConfig_D, preCutConfiguration_nonFSP)
p.addChannel(['K-', 'pi+:special'])
particles.append(p)

selection_path = create_path()
selection_path.add_module('RootInput')

feistate = fullEventInterpretation(None, selection_path, particles)

# show constructed path
feistate.path.add_module('PrintCollections')
print(feistate.path)
process(feistate.path)

print(statistics)
