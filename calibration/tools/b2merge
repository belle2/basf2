#!/usr/bin/env python3
# -*- coding: utf-8 -*-

##########################################################################
# basf2 (Belle II Analysis Software Framework)                           #
# Author: The Belle II Collaboration                                     #
#                                                                        #
# See git log for contributors and copyright holders.                    #
# This file is licensed under LGPL-3.0, see LICENSE.md.                  #
##########################################################################

import sys
import ROOT


def printUsage():
    print('Merges ROOT files with any ROOT/Belle2 objects which are mergeable.')
    print(' - Use for files generated by writing content of persistent DataStore objects to a (standard) TFile.')
    print(' - For files generated by RootOutput (with basf2 file structure), use RootInput for merging.')
    print('Usage: b2merge OUTPUT_FILE INPUT_FILE1 [INPUT_FILE2 ...]')


def doMerge(outFile, inFiles):
    merger = ROOT.TFileMerger()  # (False, False)
    merger.SetPrintLevel(1000)
    if not merger.OutputFile(outFile):
        raise IOError("Cannot open output .root file")

    for file in inFiles:
        merger.AddFile(file)

    if not merger.Merge():
        raise RuntimeError("Merging of files failed")

if len(sys.argv) < 3:
    printUsage()
    sys.exit(1)

outFile = sys.argv[1]
inFiles = sys.argv[2:]

ROOT.gSystem.Load('libframework')
ROOT.gSystem.Load('libgenfit2')
ROOT.gSystem.Load('libdataobjects')
doMerge(outFile, inFiles)
