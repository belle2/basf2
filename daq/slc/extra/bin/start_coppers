#!/bin/bash

label=`date +%Y-%m-%d`

restartBySSH() {
  mkdir -p ~/run/$2/$1
  ssh $1 "killall $2"
  ssh $1 "source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local $2 $3 $4&> ~/run/$2/$1/${label}.log" &
}

mkdir -p ~/run/logger/belle-rpc1
kill `ps aux | grep "loggerd SV" | grep -v grep | awk '{print $2}'`
source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local loggerd SVD &> ~/run/logger/belle-rpc1/logger-${label}.log &

#mkdir -p ~/run/rocontrold/belle-rpc1
#kill `ps aux | grep "rocontrold ROPC01" | grep -v grep | awk '{print $2}'`
#source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local rocontrold ROPC01 &> ~/run/rocontrold/belle-rpc1/${label}.log &

ssh belle-rpc1 "source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local  ~/run/$2/$1/${label}.log" &
ssh cpr010 "source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local cprcontrold CPR010 svd &> ~/run/$2/$1/${label}.log" &
ssh cpr011 "source ~/belle2/release/daq/slc/extra/bin/setup.sh ~/belle2 release local cprcontrold CPR010 svd &> ~/run/$2/$1/${label}.log" &
#restartBySSH cpr010 cprcontrold CPR010 svd
#restartBySSH cpr011 cprcontrold CPR011 svd
#restartBySSH cpr012 cprcontrold CPR010 svd
#restartBySSH cpr013 cprcontrold CPR011 svd

