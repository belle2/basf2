#!/bin/bash

cd $HOME/belle2/release
source ../tools/setup_belle2
setuprel

dir="${HOME}/belle2/release/daq/slc/extra/bin"

echo "killing nsmd2"
for i in $(seq 5014 5026)
do
echo "killing nsmd2 in cpr${i}"
ssh cpr${i} "killall nsmd2 > /dev/null 2> /dev/null; killall datad > /dev/null 2> /dev/null"
done

echo "killing nsmd2 in ecl02"
ssh ecl02 "killall nsmd2 > /dev/null 2> /dev/null; killall datad > /dev/null 2> /dev/null"

echo "booting nsmd2"
for i in $(seq 5014 5026)
do
echo "booting nsmd2 in cpr${i}"
arr=($(getconfig cpr${i} logfile.dir nsm.local.host nsm.local.port))
ssh cpr${i} "${dir}/boot_nsmd2 ${arr[0]} ${arr[1]} ${arr[2]}"
done

echo "booting nsmd2 in ecl02"
arr=($(getconfig ecl02 logfile.dir nsm.local.host nsm.local.port))
ssh ecl02 "${dir}/boot_nsmd2 ${arr[0]} ${arr[1]} ${arr[2]}"
sleep 5
