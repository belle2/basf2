#!/bin/bash

cd $HOME/belle2/release
source ../tools/setup_belle2
setuprel

dir="${HOME}/belle2/release/daq/slc/extra/bin"

echo "killing nsmd2"
for i in $(seq 1 6)
do
echo "killing nsmd2 in cpr00${i}"
ssh cpr00${i} "killall nsmd2 > /dev/null 2> /dev/null; killall datad > /dev/null 2> /dev/null"
done

echo "killing nsmd2 in ropc01"
ssh ropc01 "killall nsmd2 > /dev/null 2> /dev/null; killall datad > /dev/null 2> /dev/null"

echo "booting nsmd2"
for i in $(seq 1 6)
do
echo "booting nsmd2 in cpr00${i}"
arr=($(getconfig cpr00${i} logfile.dir nsm.local.host nsm.local.port))
ssh cpr00${i} "${dir}/boot_nsmd2 ${arr[1]} ${arr[2]} ${arr[3]}"
done

echo "booting nsmd2 in ropc01"
arr=($(getconfig ropc01 logfile.dir nsm.local.host nsm.local.port))
ssh ropc01 "${dir}/boot_nsmd2 ${arr[1]} ${arr[2]} ${arr[3]}"
sleep 5
